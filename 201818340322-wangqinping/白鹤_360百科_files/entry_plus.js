$.extend($.namespace("Baike.Entry_newsfeed"),function(){function e(){this._entryStream=$("#entry_newsfeed"),this._entryPlus=$(".entry-plus"),this._entryDetail=$(".entry-detail-business").length>0?$(".entry-detail-business"):$(".entry-detail"),this.query=$INFO.onesearchQuery?$INFO.onesearchQuery:$INFO.ename,this.newsfeed_conf1=null,this.newsfeed_conf2=null,this.hasModuleShowLog=!1,this.hasReq=!1,this.firstDatas=null}return e.prototype={init:function(){this.initNewsfeed(),this.bindEvent(),this.isNewsfeedModShow()&&Baike.Log.sendShowLog({id:["info-onesearch-display-module"]}),this.reqData()},initNewsfeed:function(){var e=this;e.newsfeed_conf1={source:"onesearch",url:"/OneSearch/nextPage",queryword:e.query,container:"#entry_newsfeed .onesearch-wrap",method:"get",reqNum:2,showMoreLoop:-1,flowWidth:720,noDataNoPlaceholder:!0,showid:"ziMIn3",flowcLogAttr:'data-log="info-stream-item"',busiShowLogAttr:'data-log-show="info-stream-ad-show"',busicLogAttr:'data-log="info-stream-ad"',insertPos:[1],success:function(t){e.firstDatas||(e.firstDatas=e.reGetFirstData(t.items[0],"onesearch")),Baike.Log.sendShowLog({id:["info-stream-onesearch-hasdata"]}),Baike.Log.sendShowLog({id:["info-stream-display-content"]})}},e.newsfeed_conf2={source:"360kuai",url:"https://papi.look.360.cn/mlist",container:"#entry_newsfeed .kuaizixun-wrap",sign:"baike",queryword:this.query,reqNum:10,showMoreLoop:2,flowWidth:720,flowcLogAttr:'data-log="info-stream-item"',busiShowLogAttr:'data-log-show="info-stream-ad-show"',busicLogAttr:'data-log="info-stream-ad"',showid:"ziMIn3",insertPos:[1,3,5,7,9],success:function(t){e.firstDatas||(e.firstDatas=e.reGetFirstData(t.data.res[0],"kuaizixun")),Baike.Log.sendShowLog({id:["info-stream-display-content"]})}}},reqData:function(){var e=this;mixAllFlows(e.newsfeed_conf1),setTimeout(function(){mixAllFlows(e.newsfeed_conf2)},500),this.hasReq=!0},reGetFirstData:function(e,t){var n={title:"",img:""};return t==="onesearch"?(n.title=this.filterSpecialChar(e.title),n.img=e.attr.image_url?e.attr.image_url.split("|")[0].trim():""):t==="kuaizixun"&&(n.title=this.filterSpecialChar(e.t),n.img=e.i?e.i.split("|")[0]:""),n},filterSpecialChar:function(e){var t="";return e.length==0?"":(t=e.replace(/\s/g,""),t=t.replace(/&lt;[\/]?[a-zA-Z]+&gt;/g,""),t=t.replace(/<[\/]?[a-zA-Z]+>/g,""),t=t.replace(/&amp;/g,"&"),t=t.replace(/&nbsp;/g," "),t=t.replace(/&#39;/g,"'"),t=t.replace(/&quot;/g,'"'),t=t.replace(/amp[;]?/g,""),t)},bindEvent:function(){var e=this;e.isNewsfeedModShow()||($(window).on("scroll.isNewsfeedPopup",function(){e.firstDatas&&e.isToEntryDetail()&&(e.popupAction("#main")(e.firstDatas),$(window).off("scroll.isNewsfeedPopup"))}),$(window).on("scroll.isToNewsfeedMod",function(){e.isNewsfeedModShow()&&(Baike.Log.sendShowLog({id:["info-onesearch-display-module"]}),$(window).off("scroll.isNewsfeedPopup"),$(window).off("scroll.isToNewsfeedMod"))}))},isNewsfeedModShow:function(){return this._entryStream.offset().top<=$(window).scrollTop()+$(window).height()},isToEntryDetail:function(){var e=$(document).scrollTop(),t=this._entryDetail.offset().top;return e>t+200?!0:!1},popupAction:function(e){var t=this,n=!0;return function(r){if(!n)return;n=!1;var i=typeof e=="object"?e:$(e),s;r.title=r.title.length<30?r.title:r.title.substr(0,30)+"...",s=$("#entry-newsfeed-popup-tmpl").tmpl(r),i.append(s),s.toggle(!0),t.popupAnimation(s,!0),$(".js-newsfeed-popup").on("click",".js-newsfeed-popup-open",function(){Baike.Log.send({c:"info-onesearch-click-popup"}),$("html,body").stop(!0).animate({scrollTop:t._entryPlus.offset().top},400),t.popupAnimation(s,!1)}),$(".js-newsfeed-popup").on("click",".js-newsfeed-popup-close",function(){Baike.Log.send({c:"info-onesearch-close-popup"}),t.popupAnimation(s,!1)}),$(window).on("scroll.closePopup",function(){var e=$(document).scrollTop(),n=$(window).height(),r=t._entryPlus.offset().top;e+n>r&&t.popupAnimation(s,!1)}),setTimeout(function(){t.popupAnimation(s,!1)},15e3)}},popupAnimation:function(e,t){t&&e.show();var n="20px";t||(n="-460px",$(window).off("scroll.closePopup")),e.animate({right:n},200,"swing",function(){!t&&e.hide(),t?Baike.Log.sendShowLog({id:["info-onesearch-display-popup"]}):""})}},new e}()),$(function(){function a(e){e?$(window).on("resize.fixPLusRight",function(){f()}):$(window).off("resize.fixPLusRight")}function f(){var e=n.offset().left+s-$(window).scrollLeft();r.css("left",e+"px")}var e=$(".entry-plus"),t=$(".js-plus-body",e),n=$(".js-plus-left",e),r=$(".js-plus-right",e),i=t.width(),s=n.width(),o=r.width(),u=!1;$(window).on("scroll",function(){t.offset().top<=$(window).scrollTop()?(r.addClass("fixed"),f(),u||(a(!0),u=!0)):(r.removeClass("fixed"),r.css("left",""),u&&a(!1),u=!1)}),Baike.Entry_newsfeed.init()}());